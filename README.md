# ğŸ” Glass-Box SQL Agent

AI ê¸°ë°˜ íˆ¬ëª…í•œ SQL ë¶„ì„ í”Œë«í¼ - LLMì„ í™œìš©í•œ ìì—°ì–´ ê¸°ë°˜ ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ ë„êµ¬

![Python](https://img.shields.io/badge/Python-3.8+-blue.svg)
![Flask](https://img.shields.io/badge/Flask-3.0+-green.svg)
![Gemini](https://img.shields.io/badge/Google-Gemini-orange.svg)
![License](https://img.shields.io/badge/License-MIT-yellow.svg)

## ğŸ“Œ í”„ë¡œì íŠ¸ ê°œìš”

Glass-Box SQL AgentëŠ” **"íˆ¬ëª…ì„±(Transparency)"**ì„ í•µì‹¬ ê°€ì¹˜ë¡œ í•˜ëŠ” AI ê¸°ë°˜ SQL ì¿¼ë¦¬ ìƒì„± ë„êµ¬ì…ë‹ˆë‹¤. 
ì¼ë°˜ì ì¸ ë¸”ë™ë°•ìŠ¤ AIì™€ ë‹¬ë¦¬, **LLMì˜ ì‚¬ê³  ê³¼ì •(Chain-of-Thought)ê³¼ ìƒì„±ëœ SQLì„ ëª¨ë‘ ê³µê°œ**í•˜ì—¬ ì‚¬ìš©ìê°€ ê²°ê³¼ë¥¼ ê²€ì¦í•˜ê³  ì‹ ë¢°í•  ìˆ˜ ìˆë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤.

### ğŸ¯ í•µì‹¬ ê¸°ëŠ¥

- **ğŸ¤– ìì—°ì–´ â†’ SQL ë³€í™˜**: Google Geminië¥¼ í™œìš©í•œ ì •í™•í•œ ì¿¼ë¦¬ ìƒì„±
- **ğŸ“Š ìŠ¤í‚¤ë§ˆ ê¸°ë°˜ ë¶„ì„**: ë™ì  ìŠ¤í‚¤ë§ˆ ì£¼ì…ìœ¼ë¡œ í™˜ê°(Hallucination) ìµœì†Œí™”
- **ğŸ’¡ ì¸í…”ë¦¬ì „íŠ¸ ì¶”ì²œ**: DB êµ¬ì¡°ë¥¼ ë¶„ì„í•´ ìœ ìš©í•œ ì§ˆë¬¸ ìë™ ì œì•ˆ
- **ğŸ‘ï¸ íˆ¬ëª…í•œ í”„ë¡œì„¸ìŠ¤**: AIì˜ ì¶”ë¡  ê³¼ì •ê³¼ ìƒì„±ëœ SQL ì‹¤ì‹œê°„ ê³µê°œ
- **ğŸ›¡ï¸ Human-in-the-Loop**: ì‚¬ìš©ì ê²€ì¦ í›„ ì‹¤í–‰í•˜ëŠ” ì•ˆì „ì¥ì¹˜
- **ğŸ“œ ì¿¼ë¦¬ íˆìŠ¤í† ë¦¬**: ê³¼ê±° ì§ˆë¬¸/SQL ì €ì¥ ë° ì¬ì‚¬ìš©
- **ğŸ“¥ ë°ì´í„° ë‚´ë³´ë‚´ê¸°**: CSV/Excel í˜•ì‹ ì§€ì›
- **ğŸ—‚ï¸ ìŠ¤í‚¤ë§ˆ ì‹œê°í™”**: Mermaid.js ê¸°ë°˜ ER ë‹¤ì´ì–´ê·¸ë¨

---

## ğŸ—ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Frontend Layer                        â”‚
â”‚  HTML/CSS/JS (Vanilla) + Pretendard Font + Mermaid.js       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Application Layer                       â”‚
â”‚                         Flask API                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ Schema       â”‚  â”‚ Query        â”‚  â”‚ History      â”‚      â”‚
â”‚  â”‚ Analyzer     â”‚  â”‚ Generator    â”‚  â”‚ Manager      â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         LLM Layer                            â”‚
â”‚                    Google Gemini API                         â”‚
â”‚              (Prompt Engineering + RAG)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Data Layer                            â”‚
â”‚  SQLite (User DBs) + query_history.db (Metadata)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ ì‹œì‘í•˜ê¸°

### 1. í•„ìˆ˜ ìš”êµ¬ì‚¬í•­

- Python 3.8 ì´ìƒ
- Google Gemini API Key ([ë°œê¸‰ë°›ê¸°](https://makersuite.google.com/app/apikey))

### 2. ì„¤ì¹˜
```bash
# ì €ì¥ì†Œ í´ë¡ 
git clone https://github.com/yourusername/glass-box-sql-agent.git
cd glass-box-sql-agent

# ê°€ìƒí™˜ê²½ ìƒì„± ë° í™œì„±í™”
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# ì˜ì¡´ì„± ì„¤ì¹˜
pip install -r requirements.txt
```

### 3. í™˜ê²½ ì„¤ì •

`.env` íŒŒì¼ ìƒì„±:
```env
GEMINI_API_KEY=your_gemini_api_key_here
```

### 4. ìƒ˜í”Œ ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±
```bash
cd database
python init_dbs.py
python init_history.py
cd ..
```

### 5. ì„œë²„ ì‹¤í–‰
```bash
python app.py
```

ë¸Œë¼ìš°ì €ì—ì„œ `http://localhost:5000` ì ‘ì†

---

## ğŸ“‚ í”„ë¡œì íŠ¸ êµ¬ì¡°
```
sql-agent/
â”œâ”€â”€ app.py                    # Flask ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜
â”œâ”€â”€ config.py                 # DB ì„¤ì • ë° ê²½ë¡œ ê´€ë¦¬
â”œâ”€â”€ requirements.txt          # ì˜ì¡´ì„± íŒ¨í‚¤ì§€
â”œâ”€â”€ .env                      # í™˜ê²½ ë³€ìˆ˜ (API í‚¤)
â”‚
â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ init_dbs.py          # ìƒ˜í”Œ DB ìƒì„± ìŠ¤í¬ë¦½íŠ¸
â”‚   â”œâ”€â”€ init_history.py      # íˆìŠ¤í† ë¦¬ DB ì´ˆê¸°í™”
â”‚   â”œâ”€â”€ metadata.json        # DB ë©”íƒ€ë°ì´í„°
â”‚   â”œâ”€â”€ ecommerce.db         # ì „ììƒê±°ë˜ ìƒ˜í”Œ DB
â”‚   â”œâ”€â”€ hr_management.db     # ì¸ì‚¬ê´€ë¦¬ ìƒ˜í”Œ DB
â”‚   â”œâ”€â”€ finance.db           # ì¬ë¬´ ìƒ˜í”Œ DB
â”‚   â””â”€â”€ query_history.db     # ì¿¼ë¦¬ íˆìŠ¤í† ë¦¬ ì €ì¥ì†Œ
â”‚
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ gemini_client.py     # Gemini API ë˜í¼
â”‚   â”œâ”€â”€ schema_analyzer.py   # ìŠ¤í‚¤ë§ˆ ë¶„ì„ ë° ë‹¤ì´ì–´ê·¸ë¨ ìƒì„±
â”‚   â””â”€â”€ query_generator.py   # SQL ìƒì„± ë° ì‹¤í–‰ ë¡œì§
â”‚
â”œâ”€â”€ templates/
â”‚   â”œâ”€â”€ base.html            # ê¸°ë³¸ ë ˆì´ì•„ì›ƒ
â”‚   â”œâ”€â”€ home.html            # DB ì„ íƒ í™”ë©´
â”‚   â””â”€â”€ dashboard.html       # ì¿¼ë¦¬ ëŒ€ì‹œë³´ë“œ
â”‚
â””â”€â”€ static/
    â”œâ”€â”€ css/
    â”‚   â””â”€â”€ style.css        # ì»¤ìŠ¤í…€ ìŠ¤íƒ€ì¼ (ë‹¤í¬ í…Œë§ˆ)
    â””â”€â”€ js/
        â”œâ”€â”€ main.js          # ê³µí†µ ìœ í‹¸ë¦¬í‹°
        â””â”€â”€ dashboard.js     # ëŒ€ì‹œë³´ë“œ ë¡œì§
```

---

## ğŸ’¡ ì£¼ìš” ê¸°ìˆ  ìŠ¤íƒ

| ë¶„ë¥˜ | ê¸°ìˆ  |
|------|------|
| **Backend** | Flask, Python 3.8+ |
| **Database** | SQLite |
| **LLM** | Google Gemini API |
| **Frontend** | Vanilla JavaScript, Pretendard Font |
| **Visualization** | Mermaid.js |
| **Export** | openpyxl (Excel), csv (CSV) |

---

## ğŸ¨ ì£¼ìš” í™”ë©´

### 1. í™ˆ í™”ë©´
- ë‹¤ì¤‘ ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬
- DB ì¶”ê°€/ì‚­ì œ ê¸°ëŠ¥
- ëª¨ë˜ ë‹¤í¬ í…Œë§ˆ UI

### 2. ëŒ€ì‹œë³´ë“œ
- **ì¢Œì¸¡ ì‚¬ì´ë“œë°”**: ì¿¼ë¦¬ íˆìŠ¤í† ë¦¬
- **ë©”ì¸ ì˜ì—­**:
  - DB êµ¬ì¡° ìë™ ë¶„ì„
  - AI ì¶”ì²œ ì§ˆë¬¸
  - ìì—°ì–´ ì…ë ¥ â†’ SQL ìƒì„±
  - ê²°ê³¼ í…Œì´ë¸” + ë‚´ë³´ë‚´ê¸°

### 3. Glass-Box íŠ¹ì§•
```
ì‚¬ìš©ì ì§ˆë¬¸: "VIP ê³ ê°ë“¤ì˜ í‰ê·  êµ¬ë§¤ ê¸ˆì•¡ì€?"
            â†“
ğŸ’­ AI ì‚¬ê³  ê³¼ì •:
"Users í…Œì´ë¸”ì—ì„œ tier='VIP'ì¸ ê³ ê°ì„ í•„í„°ë§í•˜ê³ ,
Orders í…Œì´ë¸”ê³¼ JOINí•˜ì—¬ í‰ê·  ê¸ˆì•¡ì„ ê³„ì‚°í•©ë‹ˆë‹¤."
            â†“
ğŸ“ ìƒì„±ëœ SQL:
SELECT AVG(o.amount)
FROM Users u
JOIN Orders o ON u.user_id = o.user_id
WHERE u.tier = 'VIP'
            â†“
[ì‚¬ìš©ì ê²€ì¦ í›„ ì‹¤í–‰ ë²„íŠ¼ í´ë¦­]
            â†“
ğŸ“Š ê²°ê³¼: 1,250,000ì›
```

---

## ğŸ”§ ì„¤ì • ë° ì»¤ìŠ¤í„°ë§ˆì´ì§•

### DB ì¶”ê°€ ë°©ë²•

1. UIì—ì„œ "ìƒˆ ë°ì´í„°ë² ì´ìŠ¤" ì¹´ë“œ í´ë¦­
2. DB Key, ì´ë¦„, ì„¤ëª…, ì•„ì´ì½˜ ì…ë ¥
3. SQLite íŒŒì¼ ìë™ ìƒì„±ë¨
4. í…Œì´ë¸” ìƒì„±ì€ ë³„ë„ë¡œ ì§„í–‰

### í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§

`utils/schema_analyzer.py`ì™€ `utils/query_generator.py`ì—ì„œ í”„ë¡¬í”„íŠ¸ ì»¤ìŠ¤í„°ë§ˆì´ì§• ê°€ëŠ¥:
```python
# ì˜ˆ: SQL ìƒì„± ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸
prompt = f"""
ë‹¹ì‹ ì€ SQLite ì „ë¬¸ê°€ì…ë‹ˆë‹¤. 
ì•„ë˜ ìŠ¤í‚¤ë§ˆë¥¼ ì°¸ê³ í•˜ì—¬ ì§ˆë¬¸ì— ë§ëŠ” ì¿¼ë¦¬ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”.

<ìŠ¤í‚¤ë§ˆ>
{schema_text}

<ì§ˆë¬¸>
{user_question}
...
"""
```

---

## ğŸ“Š ìƒ˜í”Œ ë°ì´í„°ë² ì´ìŠ¤

### 1. E-Commerce DB
- **í…Œì´ë¸”**: Users, Products, Orders
- **ìƒ˜í”Œ ì§ˆë¬¸**:
  - "ì§€ë‚œ 30ì¼ê°„ ê°€ì¥ ë§ì´ íŒ”ë¦° ìƒí’ˆ TOP 5ëŠ”?"
  - "VIP ê³ ê°ì˜ í‰ê·  ì£¼ë¬¸ ê¸ˆì•¡ì€?"

### 2. HR Management DB
- **í…Œì´ë¸”**: Employees, Departments, Salaries
- **ìƒ˜í”Œ ì§ˆë¬¸**:
  - "ë¶€ì„œë³„ í‰ê·  ì—°ë´‰ì€?"
  - "ì…ì‚¬í•œ ì§€ 3ë…„ ì´ìƒ ëœ ì§ì› ìˆ˜ëŠ”?"

### 3. Finance DB
- **í…Œì´ë¸”**: Accounts, Transactions
- **ìƒ˜í”Œ ì§ˆë¬¸**:
  - "ì´ë²ˆ ë‹¬ ì´ ì§€ì¶œì€?"
  - "ë¹„ìš© í•­ëª©ë³„ í•©ê³„ëŠ”?"

---

## ğŸ› ï¸ ê°œë°œ ë°°ê²½ ë° í•™ìŠµ í¬ì¸íŠ¸

### LLMOps ê´€ì 
- **ë™ì  ìŠ¤í‚¤ë§ˆ ì£¼ì…**: RAGì˜ ê¸°ì´ˆ ê°œë… ì ìš©
- **Few-shot Learning**: í”„ë¡¬í”„íŠ¸ì— ì˜ˆì‹œ í¬í•¨ìœ¼ë¡œ ì •í™•ë„ í–¥ìƒ
- **ì¶œë ¥ íŒŒì‹±**: XML íƒœê·¸ ê¸°ë°˜ êµ¬ì¡°í™”ëœ ì‘ë‹µ ì²˜ë¦¬

### ì—”ì§€ë‹ˆì–´ë§ ê´€ì 
- **3-Tier Architecture**: Presentation - Application - Data ë¶„ë¦¬
- **RESTful API ì„¤ê³„**: `/api/` ì—”ë“œí¬ì¸íŠ¸ í‘œì¤€í™”
- **ìƒíƒœ ê´€ë¦¬**: SQLite ê¸°ë°˜ íˆìŠ¤í† ë¦¬ ì˜êµ¬ ì €ì¥

### UX/AX ê´€ì 
- **ì„¤ëª… ê°€ëŠ¥í•œ AI(XAI)**: ì‚¬ê³  ê³¼ì • ê³µê°œë¡œ ì‹ ë¢°ì„± í™•ë³´
- **Human-in-the-Loop**: ì‹¤í–‰ ì „ ì‚¬ìš©ì ê²€ì¦ ë‹¨ê³„ í•„ìˆ˜í™”
- **ì ì§„ì  ê³µê°œ**: ë¡œë”© ìƒíƒœ â†’ ê²°ê³¼ â†’ ìƒì„¸ ì •ë³´ ìˆœì°¨ í‘œì‹œ

---

## ğŸš§ í–¥í›„ ê°œì„  ê³„íš

- [ ] PostgreSQL, MySQL ë“± ë‹¤ë¥¸ DBMS ì§€ì›
- [ ] ë³µì¡í•œ ì¿¼ë¦¬ ìë™ ìµœì í™”
- [ ] ì¿¼ë¦¬ ì‹¤í–‰ ê³„íš(Explain) ì‹œê°í™”
- [ ] ì‚¬ìš©ìë³„ ê¶Œí•œ ê´€ë¦¬ (Read-Only/Read-Write)
- [ ] WebSocket ê¸°ë°˜ ì‹¤ì‹œê°„ ì¿¼ë¦¬ ìŠ¤íŠ¸ë¦¬ë°
- [ ] ì°¨íŠ¸ ìë™ ìƒì„± (Plotly, Chart.js)

---

## ğŸ“ ë¼ì´ì„ ìŠ¤

MIT License

---

## ğŸ‘¤ ê°œë°œì

**[Your Name]**
- GitHub: [@yourusername](https://github.com/yourusername)
- Email: your.email@example.com

---

## ğŸ™ ì°¸ê³  ìë£Œ

- [Google Gemini API Documentation](https://ai.google.dev/docs)
- [Flask Documentation](https://flask.palletsprojects.com/)
- [Mermaid.js Documentation](https://mermaid.js.org/)
- [Anthropic Prompt Engineering Guide](https://docs.anthropic.com/en/docs/prompt-engineering)

---

**â­ ì´ í”„ë¡œì íŠ¸ê°€ ë„ì›€ì´ ë˜ì—ˆë‹¤ë©´ Starë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”!**
```

**â†’ í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— `README.md` íŒŒì¼ ë§Œë“¤ê³  ì´ê±¸ ë„£ì–´ì¤˜.**

---

## ì¶”ê°€: `.gitignore` ìµœì¢… í™•ì¸
```
# Python
__pycache__/
*.py[cod]
*$py.class
*.so
.Python
venv/
env/
ENV/

# Flask
instance/
.webassets-cache

# Database
*.db
*.sqlite
*.sqlite3

# í™˜ê²½ ë³€ìˆ˜
.env
.env.local

# IDE
.vscode/
.idea/
*.swp
*.swo
*~

# OS
.DS_Store
Thumbs.db

# ë¡œê·¸
*.log
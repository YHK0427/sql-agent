{% extends "base.html" %}

{% block title %}{{ db_info.name }} Dashboard{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- ÏÇ¨Ïù¥ÎìúÎ∞î -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <a href="/" class="back-btn">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <path d="M12.5 15L7.5 10L12.5 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </a>
            <div class="db-info">
                <span class="db-icon-large">{{ db_info.icon }}</span>
                <div>
                    <h2 class="db-title">{{ db_info.name }}</h2>
                    <p class="db-subtitle">{{ db_info.description }}</p>
                </div>
            </div>
        </div>

        <!-- ÌûàÏä§ÌÜ†Î¶¨ -->
        <div class="sidebar-section">
            <div class="section-header">
                <h3>ÏµúÍ∑º ÏøºÎ¶¨</h3>
                <button class="icon-btn" onclick="loadHistory()">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                        <path d="M14 8A6 6 0 1 1 8 2" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                        <path d="M8 2v4l2 2" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>
            <div id="query-history" class="history-list">
                <div class="loading">Î°úÎî© Ï§ë...</div>
            </div>
        </div>
    </aside>

    <!-- Î©îÏù∏ ÏΩòÌÖêÏ∏† -->
    <main class="main-content">
        <!-- Ïä§ÌÇ§Îßà Î∂ÑÏÑù -->
        <section class="content-section">
            <h3 class="section-title">üìä Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Íµ¨Ï°∞</h3>
            <div class="info-card">
                <div id="schema-analysis" class="loading">LLM Î∂ÑÏÑù Ï§ë...</div>
            </div>
        </section>

        <!-- Ï∂îÏ≤ú ÏßàÎ¨∏ -->
        <section class="content-section">
            <h3 class="section-title">üí° Ï∂îÏ≤ú ÏßàÎ¨∏</h3>
            <div id="suggested-queries" class="suggestions-grid">
                <div class="loading">ÏÉùÏÑ± Ï§ë...</div>
            </div>
        </section>

        <!-- ÏøºÎ¶¨ ÏûÖÎ†• -->
        <section class="content-section">
            <h3 class="section-title">üîç ÏßàÎ¨∏ÌïòÍ∏∞</h3>
                        <!-- Î™®Îç∏ ÏÑ†ÌÉù Ï∂îÍ∞Ä -->
            <div class="model-selector">
                <label for="model-select">ÏÇ¨Ïö© Î™®Îç∏:</label>
                <select id="model-select">
                    <option value="gemini-pro">gemini-2.5-flash</option>
                </select>
            </div>
            <div class="query-input-card">
                <textarea id="user-query" placeholder="Ïòà: ÏßÄÎÇúÎã¨ Îß§Ï∂ú TOP 5 ÏÉÅÌíàÏùÄ?" rows="3"></textarea>
                <button class="btn btn-primary" id="generate-sql-btn">
                    <span id="generate-btn-text">SQL ÏÉùÏÑ±</span>
                    <span id="generate-spinner" class="spinner hidden"></span>
                </button>
            </div>
        </section>

        <!-- SQL Í≤∞Í≥º -->
        <section class="content-section hidden" id="sql-result-section">
            <div class="result-grid">
                <div class="result-card">
                    <h4>üí≠ AI ÏÇ¨Í≥† Í≥ºÏ†ï</h4>
                    <div id="ai-reasoning" class="reasoning-text"></div>
                </div>
                <div class="result-card">
                    <h4>üìù ÏÉùÏÑ±Îêú SQL</h4>
                    <pre id="generated-sql" class="sql-code"></pre>
                    <button class="btn btn-success" id="execute-sql-btn">
                        <span id="execute-btn-text">Ïã§Ìñâ</span>
                        <span id="execute-spinner" class="spinner hidden"></span>
                    </button>
                </div>
            </div>
        </section>

        <!-- Ïã§Ìñâ Í≤∞Í≥º -->
        <section class="content-section hidden" id="result-section">
            <div class="result-header">
                <h3 class="section-title">üìã Ïã§Ìñâ Í≤∞Í≥º</h3>
                <div class="export-buttons">
                    <button class="btn btn-sm" onclick="exportData('csv')">CSV</button>
                    <button class="btn btn-sm" onclick="exportData('excel')">Excel</button>
                </div>
            </div>
            <div class="table-container">
                <div id="query-result"></div>
            </div>
        </section>

        <!-- Ïä§ÌÇ§Îßà Îã§Ïù¥Ïñ¥Í∑∏Îû® -->
        <section class="content-section">
            <div class="collapsible-header" onclick="toggleDiagram()">
                <h3 class="section-title">üóÇÔ∏è Ïä§ÌÇ§Îßà Îã§Ïù¥Ïñ¥Í∑∏Îû®</h3>
                <span id="diagram-toggle" class="toggle-icon">‚ñº</span>
            </div>
            <div id="diagram-container" class="diagram-wrapper hidden">
                <div id="schema-diagram" class="loading">Î°úÎî© Ï§ë...</div>
            </div>
        </section>
    </main>
</div>

{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}